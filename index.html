<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ポケモン自動選出（USUM）</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4caf50">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ポケ選出">
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f5f5f5;
      padding: 16px;
    }
    h1 {
      text-align: center;
    }
    .box {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    button {
      width: 100%;
      padding: 14px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #4caf50;
      color: white;
    }
  </style>
</head>
<body>

<h1>ポケモン自動選出</h1>

<div class="box">
  <h2>選出数（1パターンあたり）</h2>
  <select id="teamSize">
    <option value="3" selected>3体</option>
    <option value="4">4体</option>
    <option value="6">6体</option>
  </select>
</div>

<div class="box">
  <h2>世代</h2>
  <label><input type="checkbox" class="gen" value="1" checked> 第1世代</label><br>
  <label><input type="checkbox" class="gen" value="2" checked> 第2世代</label><br>
  <label><input type="checkbox" class="gen" value="3" checked> 第3世代</label><br>
  <label><input type="checkbox" class="gen" value="4" checked> 第4世代</label><br>
  <label><input type="checkbox" class="gen" value="5" checked> 第5世代</label><br>
  <label><input type="checkbox" class="gen" value="6" checked> 第6世代</label><br>
  <label><input type="checkbox" class="gen" value="7" checked> 第7世代</label>
</div>

<div class="box">
  <h2>カテゴリ</h2>
  <label><input type="checkbox" class="cat" value="normal" checked> 通常</label><br>
  <label><input type="checkbox" class="cat" value="subLegend" checked> 準伝説</label><br>
  <label><input type="checkbox" class="cat" value="legend" checked> 伝説</label><br>
  <label><input type="checkbox" class="cat" value="mythical" checked> 幻</label>
</div>

<div class="box">
  <h2>伝説・幻の最大数</h2>
  <select id="legendLimit">
    <option value="1">最大1体</option>
    <option value="2">最大2体</option>
    <option value="3">最大3体</option>
  </select>
</div>

<div class="box">
  <h2>タイプ指定（複数選択OK）</h2>
  <div id="typeFilters" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;"></div>
</div>


<div class="box">
  <label>
    <h2>同タイプの上限</h2>
    <select id="typeCap">
      <option value="0">無制限</option>
      <option value="1">1体まで</option>
      <option value="2" selected>2体まで</option>
      <option value="3">3体まで</option>
      <option value="4">4体まで</option>
      <option value="5">5体まで</option>
      <option value="6">6体まで</option>
      <option value="12">12体まで</option>
    </select>
  </label>
</div>

<div class="box">
  <label style="display:block; margin-top:10px;">
    <input type="checkbox" id="enableItems" checked>
    アイテムを持たせる
  </label>
</div>

<button onclick="resetSettings()" style="margin-top:10px;background:#777;">条件をリセット</button>

<div class="box">
  <h2>パターン1</h2>
  <ul id="team1"></ul>
</div>

<div class="box">
  <h2>パターン2</h2>
  <ul id="team2"></ul>
</div>

<button onclick="selectTeams()">選出する</button>

<div class="box">
  <h2>対戦相手（ランダム行動）</h2>
  <div id="enemyStatus">敵は待機中</div>
  <button onclick="enemyTurn()" style="margin-top:10px;">敵の行動</button>
  <ul id="battleLog"></ul>
</div>

<button onclick="resetEnemy()" style="background:#777;">
  敵の行動をリセット
</button>


<script>

const RAW_BOX = [
    "フシギソウ",
    "フシギバナ",
    "リザード",
    "リザードン",
    "カメックス",
    "バタフリー",
    "スピアー",
    "ピジョン",
    "ピジョット",
    "ラッタ",
    "オニドリル",
    "アーボック",
    "ピカチュウ",
    "ライチュウ",
    "サンドパン",
    "ニドリーナ",
    "ニドクイン",
    "ニドリーノ",
    "ニドキング",
    "ピクシー",
    "キュウコン",
    "プクリン",
    "ゴルバット",
    "クサイハナ",
    "ラフレシア",
    "パラセクト",
    "モルフォン",
    "ダグトリオ",
    "ペルシアン",
    "ゴルダック",
    "マンキー",
    "ウインディ",
    "ニョロボン",
    "ユンゲラー",
    "フーディン",
    "ゴーリキー",
    "カイリキー",
    "マダツボミ",
    "ウツドン",
    "ドククラゲ",
    "ゴローン",
    "ゴローニャ",
    "ギャロップ",
    "ヤドラン",
    "レアコイル",
    "カモネギ",
    "ドードリオ",
    "ジュゴン",
    "ベトベトン",
    "パルシェン",
    "ゴースト",
    "ゲンガー",
    "スリーパー",
    "キングラー",
    "マルマイン",
    "ナッシー",
    "ガラガラ",
    "サワムラー",
    "エビワラー",
    "マタドガス",
    "サイドン",
    "ラッキー",
    "ガルーラ",
    "シードラ",
    "アズマオウ",
    "スターミー",
    "バリヤード",
    "ストライク",
    "ルージュラ",
    "エレブー",
    "ブーバー",
    "カイロス",
    "ケンタロス",
    "ギャラドス",
    "ラプラス",
    "シャワーズ",
    "サンダース",
    "ブースター",
    "オムスター",
    "カブトプス",
    "プテラ",
    "カビゴン",
    "フリーザー",
    "サンダー",
    "ファイヤー",
    "ハクリュー",
    "カイリュー",
    "ミュウツー",
    "ベイリーフ",
    "メガニウム",
    "マグマラシ",
    "バクフーン",
    "アリゲイツ",
    "ヨルノズク",
    "レディアン",
    "アリアドス",
    "クロバット",
    "ランターン",
    "トゲチック",
    "ネイティオ",
    "デンリュウ",
    "キレイハナ",
    "マリル",
    "マリルリ",
    "ウソッキー",
    "ニョロトノ",
    "ハネッコ",
    "ポポッコ",
    "キマワリ",
    "ヌオー",
    "エーフィ",
    "ブラッキー",
    "ヤドキング",
    "ソーナンス",
    "キリンリキ",
    "フォレトス",
    "ノコッチ",
    "グライガー",
    "ハガネール",
    "グランブル",
    "ハリーセン",
    "ハッサム",
    "ツボツボ",
    "ヘラクロス",
    "リングマ",
    "マグカルゴ",
    "イノムー",
    "サニーゴ",
    "オクタン",
    "デリバード",
    "マンタイン",
    "エアームド",
    "ヘルガー",
    "キングドラ",
    "ドンファン",
    "ポリゴン2",
    "オドシシ",
    "カポエラー",
    "ミルタンク",
    "ハピナス",
    "ライコウ",
    "エンテイ",
    "スイクン",
    "サナギラス",
    "バンギラス",
    "ルギア",
    "ホウオウ",
    "ジュプトル",
    "ジュカイン",
    "ワカシャモ",
    "バシャーモ",
    "ヌマクロー",
    "ラグラージ",
    "グラエナ",
    "マッスグマ",
    "カラサリス",
    "アゲハント",
    "マユルド",
    "ドクケイル",
    "ハスブレロ",
    "ルンパッパ",
    "コノハナ",
    "ダーテング",
    "オオスバメ",
    "ペリッパー",
    "キルリア",
    "サーナイト",
    "アメモース",
    "キノガッサ",
    "ケッキング",
    "テッカニン",
    "ヌケニン",
    "ドゴーム",
    "バクオング",
    "ハリテヤマ",
    "エネコロロ",
    "ヤミラミ",
    "クチート",
    "ココドラ",
    "コドラ",
    "ボスゴドラ",
    "チャーレム",
    "ライボルト",
    "プラスル",
    "バルビート",
    "イルミーゼ",
    "サメハダー",
    "ホエルオー",
    "コータス",
    "バクーダ",
    "パッチール",
    "ビブラーバ",
    "フライゴン",
    "サボネア",
    "チルタリス",
    "ザングース",
    "ハブネーク",
    "ルナトーン",
    "ソルロック",
    "ナマズン",
    "シザリガー",
    "ネンドール",
    "リリーラ",
    "ユレイドル",
    "アーマルド",
    "ミロカロス",
    "ポワルン",
    "ジュペッタ",
    "サマヨール",
    "トロピウス",
    "チリーン",
    "アブソル",
    "オニゴーリ",
    "トドゼルガ",
    "ハンテール",
    "サクラビス",
    "ジーランス",
    "コモルー",
    "ボーマンダ",
    "メタグロス",
    "レジロック",
    "レジアイス",
    "レジスチル",
    "ラティアス",
    "ラティオス",
    "カイオーガ",
    "グラードン",
    "レックウザ",
    "ハヤシガメ",
    "ドダイトス",
    "モウカザル",
    "ゴウカザル",
    "ポッタイシ",
    "エンペルト",
    "ムクバード",
    "ムクホーク",
    "ビーダル",
    "コロトック",
    "ルクシオ",
    "レントラー",
    "ロズレイド",
    "ラムパルド",
    "トリデプス",
    "ミノマダム",
    "ガーメイル",
    "ビークイン",
    "パチリス",
    "フローゼル",
    "チェリム",
    "トリトドン",
    "エテボース",
    "フワライド",
    "ミミロップ",
    "ムウマージ",
    "ドンカラス",
    "ブニャット",
    "スカタンク",
    "ドータクン",
    "ペラップ",
    "ミカルゲ",
    "ガブリアス",
    "ルカリオ",
    "カバルドン",
    "ドラピオン",
    "ドクロッグ",
    "ネオラント",
    "ユキノオー",
    "マニューラ",
    "ジバコイル",
    "ベロベルト",
    "ドサイドン",
    "モジャンボ",
    "エレキブル",
    "ブーバーン",
    "トゲキッス",
    "メガヤンマ",
    "リーフィア",
    "グレイシア",
    "グライオン",
    "マンムー",
    "ポリゴンZ",
    "エルレイド",
    "ダイノーズ",
    "ヨノワール",
    "ユキメノコ",
    "ロトム",
    "ユクシー",
    "エムリット",
    "アグノム",
    "ディアルガ",
    "パルキア",
    "ヒードラン",
    "レジギガス",
    "ギラティナ",
    "クレセリア",
    "ジャノビー",      
    "ジャローダ",    
    "チャオブー",     
    "エンブオー",     
    "フタチマル",    
    "ダイケンキ",     
    "ミルホッグ",    
    "ハーデリア",   
    "ムーランド",    
    "レパルダス",     
    "ヤナッキー",      
    "バオッキー",    
    "ムシャーナ",    
    "ハトーボー",      
    "ケンホロウ",     
    "ゼブライカ",      
    "ガントル",       
    "ギガイアス",      
    "ココロモリ",      
    "ドリュウズ",     
    "タブンネ",        
    "ドテッコツ",      
    "ローブシン",    
    "ガマガル",        
    "ガマゲロゲ",      
    "ナゲキ",          
    "ダゲキ",          
    "クルマユ",      
    "ハハコモリ",     
    "ホイーガ",       
    "ペンドラー",     
    "エルフーン",      
    "ドレディア",      
    "バスラオ",       
    "ワルビル",       
    "ワルビアル",     
    "ヒヒダルマ",      
    "マラカッチ",      
    "イワパレス",      
    "ズルズキン",     
    "シンボラー",      
    "デスカーン",     
    "アバゴーラ",     
    "アーケオス",      
    "ダストダス",     
    "ゾロアーク",      
    "ゴチミル",        
    "ゴチルゼル",      
    "スワンナ",       
    "バニリッチ",     
    "バイバニラ",      
    "シキジカ",        
    "エモンガ",       
    "シュバルゴ",      
    "モロバレル",      
    "ブルンゲル",     
    "ママンボウ", 
    "デンチュラ",
    "ナットレイ",
    "ギギギアル",
    "シビルドン",
    "ランクルス",
    "ランプラー",
    "シャンデラ",
    "オノンド",
    "オノノクス",
    "ツンベアー",
    "フリージオ",
    "アギルダー",
    "マッギョ",
    "コジョンド",
    "クリムガン",
    "ゴルーグ",
    "コマタナ",
    "バッフロン",
    "ウォーグル",
    "バルジーナ",
    "クイタラン",
    "アイアント",
    "ジヘッド",
    "サザンドラ",
    "ウルガモス",
    "コバルオン",
    "テラキオン",
    "ビリジオン",
    "トルネロス",
    "ボルトロス",
    "レシラム",
    "ゼクロム",
    "ランドロス",
    "ハリボーグ",
    "ブリガロン",
    "テールナー",
    "マフォクシー",
    "ゲコガシラ",
    "ゲッコウガ",
    "ホルード",
    "ヒノヤコマ",
    "ファイアロー",
    "ビビヨン",
    "カエンジシ",
    "フラエッテ",
    "フラージェス",
    "ゴーゴート",
    "ゴロンダ",
    "トリミアン",
    "ニャオニクス",
    "ヒトツキ",
    "ギルガルド",
    "フレフワン",
    "ペロリーム",
    "カラマネロ",
    "ガメノデス",
    "ドラミドロ",
    "ブロスター",
    "エレザード",
    "ガチゴラス",
    "アマルルガ",
    "ニンフィア",
    "ルチャブル",
    "デデンネ",
    "メレシー",
    "ヌメイル",
    "ヌメルゴン",
    "クレッフィ",
    "ボクレー",
    "オーロット",
    "クレベース",
    "ファイアロー",
    "ゼルネアス",
    "イベルタル",
    "フクスロー",
    "ジュナイパー",
    "ニャヒート",
    "ガオガエン",
    "オシャマリ",
    "アシレーヌ",
    "ケケンカニ",
    "デカグース",
    "クワガノン",
    "アブリボン",
    "ルガルガン",
    "ドヒドイデ",
    "バンバドロ",
    "オニシズクモ",
    "ラランテス",
    "マシェード",
    "エンニュート",
    "キテルグマ",
    "アマージョ",
    "キュワワー",
    "ヤレユータン",
    "ナゲツケサル",
    "グソクムシャ",
    "シロデスナ",
    "ナマコブシ",
    "シルヴァディ",
    "メテノ",
    "ネッコアラ",
    "バクガメス",
    "トゲデマル",
    "ミミッキュ",
    "ハギギシリ",
    "ジジーロン",
    "ダダリン",
    "ジャランゴ",
    "ジャラランガ",
    "カプ・コケコ",
    "カプ・テテフ",
    "カプ・ブルル",
    "カプ・レヒレ",
    "ウツロイド",
    "マッシブーン",
    "フェローチェ",
    "デンジュモク",
    "テッカグヤ",
    "カミツルギ",
    "アクジキング",
    "ネクロズマ",
    "アローラライチュウ",
    "アローラガラガラ",
    "アローラサンドパン",
    "アローラキュウコン",
    "アローラダグトリオ",
    "アローラナッシー",
    "アローラゴローニャ",
    "アローラベトベトン"
];

const GEN_MAP = {
  1: [
        "フシギソウ",
    "フシギバナ",
    "リザード",
    "リザードン",
    "カメックス",
    "バタフリー",
    "スピアー",
    "ピジョン",
    "ピジョット",
    "ラッタ",
    "オニドリル",
    "アーボック",
    "ピカチュウ",
    "ライチュウ",
    "サンドパン",
    "ニドリーナ",
    "ニドクイン",
    "ニドリーノ",
    "ニドキング",
    "ピクシー",
    "キュウコン",
    "プクリン",
    "ゴルバット",
    "クサイハナ",
    "ラフレシア",
    "パラセクト",
    "モルフォン",
    "ダグトリオ",
    "ペルシアン",
    "ゴルダック",
    "マンキー",
    "ウインディ",
    "ニョロボン",
    "ユンゲラー",
    "フーディン",
    "ゴーリキー",
    "カイリキー",
    "マダツボミ",
    "ウツドン",
    "ドククラゲ",
    "ゴローン",
    "ゴローニャ",
    "ギャロップ",
    "ヤドラン",
    "レアコイル",
    "カモネギ",
    "ドードリオ",
    "ジュゴン",
    "ベトベトン",
    "パルシェン",
    "ゴースト",
    "ゲンガー",
    "スリーパー",
    "キングラー",
    "マルマイン",
    "ナッシー",
    "ガラガラ",
    "サワムラー",
    "エビワラー",
    "マタドガス",
    "サイドン",
    "ラッキー",
    "ガルーラ",
    "シードラ",
    "アズマオウ",
    "スターミー",
    "バリヤード",
    "ストライク",
    "ルージュラ",
    "エレブー",
    "ブーバー",
    "カイロス",
    "ケンタロス",
    "ギャラドス",
    "ラプラス",
    "シャワーズ",
    "サンダース",
    "ブースター",
    "オムスター",
    "カブトプス",
    "プテラ",
    "カビゴン",
    "フリーザー",
    "サンダー",
    "ファイヤー",
    "ハクリュー",
    "カイリュー",
    "ミュウツー"
  ],
  2: [
        "ベイリーフ",
    "メガニウム",
    "マグマラシ",
    "バクフーン",
    "アリゲイツ",
    "ヨルノズク",
    "レディアン",
    "アリアドス",
    "クロバット",
    "ランターン",
    "トゲチック",
    "ネイティオ",
    "デンリュウ",
    "キレイハナ",
    "マリル",
    "マリルリ",
    "ウソッキー",
    "ニョロトノ",
    "ハネッコ",
    "ポポッコ",
    "キマワリ",
    "ヌオー",
    "エーフィ",
    "ブラッキー",
    "ヤドキング",
    "ソーナンス",
    "キリンリキ",
    "フォレトス",
    "ノコッチ",
    "グライガー",
    "ハガネール",
    "グランブル",
    "ハリーセン",
    "ハッサム",
    "ツボツボ",
    "ヘラクロス",
    "リングマ",
    "マグカルゴ",
    "イノムー",
    "サニーゴ",
    "オクタン",
    "デリバード",
    "マンタイン",
    "エアームド",
    "ヘルガー",
    "キングドラ",
    "ドンファン",
    "ポリゴン2",
    "オドシシ",
    "カポエラー",
    "ミルタンク",
    "ハピナス",
    "ライコウ",
    "エンテイ",
    "スイクン",
    "サナギラス",
    "バンギラス",
    "ルギア",
    "ホウオウ"
  ],
  3: [
        "ジュプトル",
    "ジュカイン",
    "ワカシャモ",
    "バシャーモ",
    "ヌマクロー",
    "ラグラージ",
    "グラエナ",
    "マッスグマ",
    "カラサリス",
    "アゲハント",
    "マユルド",
    "ドクケイル",
    "ハスブレロ",
    "ルンパッパ",
    "コノハナ",
    "ダーテング",
    "オオスバメ",
    "ペリッパー",
    "キルリア",
    "サーナイト",
    "アメモース",
    "キノガッサ",
    "ケッキング",
    "テッカニン",
    "ヌケニン",
    "ドゴーム",
    "バクオング",
    "ハリテヤマ",
    "エネコロロ",
    "ヤミラミ",
    "クチート",
    "ココドラ",
    "コドラ",
    "ボスゴドラ",
    "チャーレム",
    "ライボルト",
    "プラスル",
    "バルビート",
    "イルミーゼ",
    "サメハダー",
    "ホエルオー",
    "コータス",
    "バクーダ",
    "パッチール",
    "ビブラーバ",
    "フライゴン",
    "サボネア",
    "チルタリス",
    "ザングース",
    "ハブネーク",
    "ルナトーン",
    "ソルロック",
    "ナマズン",
    "シザリガー",
    "ネンドール",
    "リリーラ",
    "ユレイドル",
    "アーマルド",
    "ミロカロス",
    "ポワルン",
    "ジュペッタ",
    "サマヨール",
    "トロピウス",
    "チリーン",
    "アブソル",
    "オニゴーリ",
    "トドゼルガ",
    "ハンテール",
    "サクラビス",
    "ジーランス",
    "コモルー",
    "ボーマンダ",
    "メタグロス",
    "レジロック",
    "レジアイス",
    "レジスチル",
    "ラティアス",
    "ラティオス",
    "カイオーガ",
    "グラードン",
    "レックウザ"
  ],
  4: [
        "ハヤシガメ",
    "ドダイトス",
    "モウカザル",
    "ゴウカザル",
    "ポッタイシ",
    "エンペルト",
    "ムクバード",
    "ムクホーク",
    "ビーダル",
    "コロトック",
    "ルクシオ",
    "レントラー",
    "ロズレイド",
    "ラムパルド",
    "トリデプス",
    "ミノマダム",
    "ガーメイル",
    "ビークイン",
    "パチリス",
    "フローゼル",
    "チェリム",
    "トリトドン",
    "エテボース",
    "フワライド",
    "ミミロップ",
    "ムウマージ",
    "ドンカラス",
    "ブニャット",
    "スカタンク",
    "ドータクン",
    "ペラップ",
    "ミカルゲ",
    "ガブリアス",
    "ルカリオ",
    "カバルドン",
    "ドラピオン",
    "ドクロッグ",
    "ネオラント",
    "ユキノオー",
    "マニューラ",
    "ジバコイル",
    "ベロベルト",
    "ドサイドン",
    "モジャンボ",
    "エレキブル",
    "ブーバーン",
    "トゲキッス",
    "メガヤンマ",
    "リーフィア",
    "グレイシア",
    "グライオン",
    "マンムー",
    "ポリゴンZ",
    "エルレイド",
    "ダイノーズ",
    "ヨノワール",
    "ユキメノコ",
    "ロトム",
    "ユクシー",
    "エムリット",
    "アグノム",
    "ディアルガ",
    "パルキア",
    "ヒードラン",
    "レジギガス",
    "ギラティナ",
    "クレセリア"
  ],
  5: [
        "ジャノビー",      
    "ジャローダ",    
    "チャオブー",     
    "エンブオー",     
    "フタチマル",    
    "ダイケンキ",     
    "ミルホッグ",    
    "ハーデリア",   
    "ムーランド",    
    "レパルダス",     
    "ヤナッキー",      
    "バオッキー",    
    "ムシャーナ",    
    "ハトーボー",      
    "ケンホロウ",     
    "ゼブライカ",      
    "ガントル",       
    "ギガイアス",      
    "ココロモリ",      
    "ドリュウズ",     
    "タブンネ",        
    "ドテッコツ",      
    "ローブシン",    
    "ガマガル",        
    "ガマゲロゲ",      
    "ナゲキ",          
    "ダゲキ",          
    "クルマユ",      
    "ハハコモリ",     
    "ホイーガ",       
    "ペンドラー",     
    "エルフーン",      
    "ドレディア",      
    "バスラオ",       
    "ワルビル",       
    "ワルビアル",     
    "ヒヒダルマ",      
    "マラカッチ",      
    "イワパレス",      
    "ズルズキン",     
    "シンボラー",      
    "デスカーン",     
    "アバゴーラ",     
    "アーケオス",      
    "ダストダス",     
    "ゾロアーク",      
    "ゴチミル",        
    "ゴチルゼル",      
    "スワンナ",       
    "バニリッチ",     
    "バイバニラ",      
    "シキジカ",        
    "エモンガ",       
    "シュバルゴ",      
    "モロバレル",      
    "ブルンゲル",     
    "ママンボウ", 
    "デンチュラ",
    "ナットレイ",
    "ギギギアル",
    "シビルドン",
    "ランクルス",
    "ランプラー",
    "シャンデラ",
    "オノンド",
    "オノノクス",
    "ツンベアー",
    "フリージオ",
    "アギルダー",
    "マッギョ",
    "コジョンド",
    "クリムガン",
    "ゴルーグ",
    "コマタナ",
    "バッフロン",
    "ウォーグル",
    "バルジーナ",
    "クイタラン",
    "アイアント",
    "ジヘッド",
    "サザンドラ",
    "ウルガモス",
    "コバルオン",
    "テラキオン",
    "ビリジオン",
    "トルネロス",
    "ボルトロス",
    "レシラム",
    "ゼクロム",
    "ランドロス"
  ],
  6: [
   "ハリボーグ",
    "ブリガロン",
    "テールナー",
    "マフォクシー",
    "ゲコガシラ",
    "ゲッコウガ",
    "ホルード",
    "ヒノヤコマ",
    "ファイアロー",
    "ビビヨン",
    "カエンジシ",
    "フラエッテ",
    "フラージェス",
    "ゴーゴート",
    "ゴロンダ",
    "トリミアン",
    "ニャオニクス",
    "ヒトツキ",
    "ギルガルド",
    "フレフワン",
    "ペロリーム",
    "カラマネロ",
    "ガメノデス",
    "ドラミドロ",
    "ブロスター",
    "エレザード",
    "ガチゴラス",
    "アマルルガ",
    "ニンフィア",
    "ルチャブル",
    "デデンネ",
    "メレシー",
    "ヌメイル",
    "ヌメルゴン",
    "クレッフィ",
    "ボクレー",
    "オーロット",
    "クレベース",
    "ファイアロー",
    "ゼルネアス",
    "イベルタル"
  ],
  7: [
        "フクスロー",
    "ジュナイパー",
    "ニャヒート",
    "ガオガエン",
    "オシャマリ",
    "アシレーヌ",
    "ケケンカニ",
    "デカグース",
    "クワガノン",
    "アブリボン",
    "ルガルガン",
    "ドヒドイデ",
    "バンバドロ",
    "オニシズクモ",
    "ラランテス",
    "マシェード",
    "エンニュート",
    "キテルグマ",
    "アマージョ",
    "キュワワー",
    "ヤレユータン",
    "ナゲツケサル",
    "グソクムシャ",
    "シロデスナ",
    "ナマコブシ",
    "シルヴァディ",
    "メテノ",
    "ネッコアラ",
    "バクガメス",
    "トゲデマル",
    "ミミッキュ",
    "ハギギシリ",
    "ジジーロン",
    "ダダリン",
    "ジャランゴ",
    "ジャラランガ",
    "カプ・コケコ",
    "カプ・テテフ",
    "カプ・ブルル",
    "カプ・レヒレ",
    "ウツロイド",
    "マッシブーン",
    "フェローチェ",
    "デンジュモク",
    "テッカグヤ",
    "カミツルギ",
    "アクジキング",
    "ネクロズマ",
    "アローラライチュウ",
    "アローラガラガラ",
    "アローラサンドパン",
    "アローラキュウコン",
    "アローラダグトリオ",
    "アローラナッシー",
    "アローラゴローニャ",
    "アローラベトベトン"
  ]
};

const CATEGORY_MAP = {
  subLegend: [
    // 第2世代
    "ライコウ", "エンテイ", "スイクン",

    // 第3世代
    "レジロック", "レジアイス", "レジスチル",
    "ラティアス", "ラティオス",

    // 第4世代
    "ユクシー", "エムリット", "アグノム",
    "ヒードラン", "クレセリア",

    // 第5世代
    "コバルオン", "テラキオン", "ビリジオン",
    "トルネロス", "ボルトロス", "ランドロス",

    // 第6世代
    // なし（実質ここは伝説寄り）

    // 第7世代
    "カプ・コケコ", "カプ・テテフ", "カプ・ブルル", "カプ・レヒレ",

    // ウルトラビースト
    "ウツロイド", "マッシブーン", "フェローチェ",
    "デンジュモク", "テッカグヤ", "カミツルギ", "アクジキング"
  ],
   legend: [
    // 第1世代
    "ミュウツー", "フリーザー", "サンダー", "ファイヤー",

    // 第2世代
    "ルギア", "ホウオウ",

    // 第3世代
    "カイオーガ", "グラードン", "レックウザ",

    // 第4世代
    "ディアルガ", "パルキア", "ギラティナ", "レジギガス",

    // 第5世代
    "レシラム", "ゼクロム",

    // 第6世代
    "ゼルネアス", "イベルタル",

    // 第7世代
    "ネクロズマ"
  ],

  mythical: [
    // 第1世代
    "ミュウ",

    // 第2世代
    "セレビィ",

    // 第3世代
    "ジラーチ",

    // 第4世代
    "マナフィ", "シェイミ", "アルセウス",

    // 第5世代
    "ビクティニ", "ケルディオ", "メロエッタ",

    // 第6世代
    "ボルケニオン",

    // 第7世代
    // USUMでは配布扱いなので必要なら追加
  ]
};

const FORM_ALIAS = {
  "アローラライチュウ": "raichu-alola",
  "アローラガラガラ": "marowak-alola",
  "アローラサンドパン": "sandslash-alola",
  "アローラキュウコン": "ninetales-alola",
  "アローラダグトリオ": "dugtrio-alola",
  "アローラナッシー": "exeggutor-alola",
  "アローラゴローニャ": "golem-alola",
  "アローラベトベトン": "muk-alola"
};

const LIMITED_CATEGORIES = ["legend", "mythical"];

const teamSize = Number(document.getElementById("teamSize").value);

const ITEM_LIST = [
  "たべのこし",
  "こだわりスカーフ",
  "こだわりハチマキ",
  "こだわりメガネ",
  "きあいのタスキ",
  "いのちのたま",
  "オボンのみ",
  "ラムのみ",
  "とつげきチョッキ",
  "じゃくてんほけん",
  "かいがらのすず",
  "ひかりのこな",
  "ピントレンズ",
  "ふうせん",
  "メトロノーム",
  "レッドカード",
  "ゴツゴツメット",
  "せんせいのツメ",
  "だっしゅつボタン",
  "たつじんのおび",
  "ちからのハチマキ",
  "ぼうじんゴーグル",
  "おうじゃのしるし",
  "ぼうごパット",
  "Zクリスタル"
];

// ===== 世代判定 =====
function getGen(name) {
  for (const gen in GEN_MAP) {
    if (GEN_MAP[gen].includes(name)) {
      return Number(gen);
    }
  }
  return null; // 見つからない場合
}

// ===== カテゴリ判定 =====
function getCategory(name) {
  for (const category in CATEGORY_MAP) {
    if (CATEGORY_MAP[category].includes(name)) {
      return category;
    }
  }
  return "normal";
}


// ===== タイプ判定 =====
function getTypes(name) {
  const result = [];

  for (const type in TYPE_MAP) {
    if (TYPE_MAP[type].includes(name)) {
      result.push(type);
    }
  }

  return result.length > 0 ? result : null;
}

// ===== 改良BOX生成 =====
window.addEventListener("DOMContentLoaded", async () => {
  try {
    await loadTypesDb();

    BOX = RAW_BOX.map(name => ({
      name,
      gen: getGen(name),
      category: getCategory(name),
      types: getTypes(name)
    }));

    renderTypeCheckboxes(); // ←追加

    loadSettings();         // ←復元（renderの後！）
    attachAutoSave();       // ←自動保存ON

    console.log("タイプ未取得:", BOX.filter(p => p.types === null).map(p => p.name));
  } catch (e) {
    console.error(e);
    alert("タイプDBの読み込みに失敗しました（types_db.json を確認してください）");
  }
});
let TYPES_DB = {}; // "日本語名" -> ["タイプ","タイプ"]

async function loadTypesDb() {
  const res = await fetch("types_db.json");
  if (!res.ok) throw new Error("types_db.json が読み込めません");
  TYPES_DB = await res.json();
}

function getTypes(name) {
  return TYPES_DB[name] ?? null;
}

let BOX = [];

// （確認用）未分類チェック
console.table(BOX);
console.log("世代未分類:", BOX.filter(p => p.gen === null));
console.log("カテゴリ未分類:", BOX.filter(p => p.category === "normal"));

function countLimited(pokemons) {
  return pokemons.filter(p =>
    p.category === "legend" || p.category === "mythical"
  ).length;
}

function shuffle(array) {
  return [...array].sort(() => Math.random() - 0.5);
}

const ALL_TYPES = [
  "ノーマル","ほのお","みず","でんき","くさ","こおり","かくとう","どく","じめん",
  "ひこう","エスパー","むし","いわ","ゴースト","ドラゴン","あく","はがね","フェアリー"
];

// チェックボックスUIを作る（DOMContentLoaded後に呼ぶ）
function renderTypeCheckboxes() {
  const wrap = document.getElementById("typeFilters");
  wrap.innerHTML = ALL_TYPES.map(t => `
    <label style="display:flex;align-items:center;gap:6px;background:#fff;padding:8px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,.08);">
      <input type="checkbox" value="${t}">
      <span>${t}</span>
    </label>
  `).join("");
}

// チェックされているタイプ一覧を取得
function getSelectedTypes() {
  return Array.from(document.querySelectorAll("#typeFilters input[type=checkbox]:checked"))
    .map(el => el.value);
}

// OR条件：選ばれたタイプのどれか1つでも含めばOK
function filterByTypes_OR(pool, selectedTypes) {
  if (selectedTypes.length === 0) return pool; // 未選択なら絞らない
  return pool.filter(p => {
    const types = p.types ?? [];
    return selectedTypes.some(t => types.includes(t));
  });
}

function countTypes(pokemons) {
  const map = {}; // { "ひこう": 3, ... }
  for (const p of pokemons) {
    const types = p.types ?? [];
    for (const t of types) {
      map[t] = (map[t] || 0) + 1;
    }
  }
  return map;
}

function isTypeCapOk(pokemons, cap) {
  if (!cap || cap <= 0) return true; // 0なら無制限
  const typeCounts = countTypes(pokemons);
  return Object.values(typeCounts).every(c => c <= cap);
}

const STORAGE_KEY = "poke_selector_settings_v1";

function pickRandomItem() {
  const i = Math.floor(Math.random() * ITEM_LIST.length);
  return ITEM_LIST[i];
}
function shuffle(arr) {
  // 既にあなたが持ってるならこれは不要（ある方を使ってOK）
  return [...arr].sort(() => Math.random() - 0.5);
}

// count体ぶん、重複なしでアイテムを配る（必要ならシャッフルして先頭から取る）
function assignUniqueItems(pokemons, items) {
  if (pokemons.length > items.length) {
    alert("アイテム数が足りません（重複なし設定のため）\nアイテムを増やすか、チーム人数を減らしてください。");
    return null;
  }

  const itemPool = shuffle(items);
  return pokemons.map((p, idx) => ({
    ...p,
    item: itemPool[idx]
  }));
}

function assignUniqueItemsToTeam(team) {
  if (team.length > ITEM_LIST.length) {
    alert("アイテム数が足りません（重複なしのため）\nアイテムを増やすか、チーム人数を減らしてください。");
    return null;
  }
  const pool = shuffle(ITEM_LIST.slice()); // チームごとに別シャッフル
  return team.map((p, idx) => ({ ...p, item: pool[idx] }));
}

// 現在のUI状態を読み取って保存
function saveSettings() {
  const settings = {
    gens: Array.from(document.querySelectorAll(".gen:checked")).map(cb => Number(cb.value)),
    cats: Array.from(document.querySelectorAll(".cat:checked")).map(cb => cb.value),
    types: Array.from(document.querySelectorAll("#typeFilters input[type=checkbox]:checked")).map(cb => cb.value),
    legendLimit: Number(document.getElementById("legendLimit")?.value ?? 0),
    teamSize: Number(document.getElementById("teamSize")?.value ?? 3),
    typeCap: Number(document.getElementById("typeCap")?.value ?? 0),
    enableItems: document.getElementById("enableItems")?.checked ?? true,
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
}

function resetSettings() {
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}

// 保存データをUIに復元
function loadSettings() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return;

  let settings;
  try {
    settings = JSON.parse(raw);
  } catch (e) {
    console.warn("保存データが壊れているので無視します", e);
    return;
  }

  // 世代
  if (Array.isArray(settings.gens)) {
    document.querySelectorAll(".gen").forEach(cb => {
      cb.checked = settings.gens.includes(Number(cb.value));
    });
  }

  // カテゴリ
  if (Array.isArray(settings.cats)) {
    document.querySelectorAll(".cat").forEach(cb => {
      cb.checked = settings.cats.includes(cb.value);
    });
  }

  // タイプ
  if (Array.isArray(settings.types)) {
    document.querySelectorAll("#typeFilters input[type=checkbox]").forEach(cb => {
      cb.checked = settings.types.includes(cb.value);
    });
  }

  //アイテムの有無
  if (document.getElementById("enableItems") && typeof settings.enableItems === "boolean") {
    document.getElementById("enableItems").checked = settings.enableItems;
  }
  // 数値系
  if (document.getElementById("legendLimit") && Number.isFinite(settings.legendLimit)) {
    document.getElementById("legendLimit").value = String(settings.legendLimit);
  }
  if (document.getElementById("teamSize") && Number.isFinite(settings.teamSize)) {
    document.getElementById("teamSize").value = String(settings.teamSize);
  }
  if (document.getElementById("typeCap") && Number.isFinite(settings.typeCap)) {
    document.getElementById("typeCap").value = String(settings.typeCap);
  }
  
}

function attachAutoSave() {
  // チェックボックス / セレクト / 入力の変更を拾う
  document.addEventListener("change", (e) => {
    const t = e.target;

    // 世代・カテゴリ・タイプ・各select が対象
    if (
      t.matches(".gen") ||
      t.matches(".cat") ||
      t.matches("#typeFilters input[type=checkbox]") ||
      t.matches("#legendLimit") ||
      t.matches("#teamSize") ||
      t.matches("#typeCap") ||
      t.matches("#enableItems")
    ) {
      saveSettings();
    }
  });
}


function selectTeams() {
  // 世代
  const enabledGens = Array.from(
    document.querySelectorAll(".gen:checked")
  ).map(cb => Number(cb.value));

  // カテゴリ
  const enabledCats = Array.from(
    document.querySelectorAll(".cat:checked")
  ).map(cb => cb.value);

  // 伝説・幻の上限
  const limit = Number(
    document.getElementById("legendLimit").value
  );

  // チーム人数
  const teamSize = Number(document.getElementById("teamSize").value);

  // 同タイプ上限（0なら無制限）
  const typeCap = Number(document.getElementById("typeCap").value);

  // 条件で絞る
  const filteredBox = BOX.filter(p =>
    enabledGens.includes(p.gen) &&
    enabledCats.includes(p.category)
  );

  if (filteredBox.length < teamSize * 2) {
    alert("条件に対してポケモンが足りません");
    return;
  }

  // 制限を満たすまで抽選
  let team1, team2, tries = 0;

  do {
    const shuffled = shuffle(filteredBox);
    // いったんアイテムなしでチームを作る
team1 = shuffled.slice(0, teamSize);
team2 = shuffled.slice(teamSize, teamSize * 2);

// アイテムON/OFF（チェックボックスが無い場合はON扱い）
let enableItems = true;
const enableItemsEl = document.getElementById("enableItems");
if (enableItemsEl) enableItems = enableItemsEl.checked;

if (enableItems) {
  // A仕様：パターン1内で重複なし、パターン2内でも重複なし（ただし相互の重複はOK）
  const t1 = assignUniqueItemsToTeam(team1);
  if (!t1) return;

  const t2 = assignUniqueItemsToTeam(team2);
  if (!t2) return;

  team1 = t1;
  team2 = t2;
} else {
  team1 = team1.map(p => ({ ...p, item: null }));
  team2 = team2.map(p => ({ ...p, item: null }));
}

tries++;

    if (tries > 400) {
      alert("条件が厳しすぎます（同タイプ上限・伝説上限などを緩めてください）");
      return;
    }
  } while (
    countLimited([...team1, ...team2]) > limit ||
    !isTypeCapOk([...team1, ...team2], typeCap)
  );

  // 表示
  document.getElementById("team1").innerHTML =
    team1.map(p => `<li>${p.name}${p.item ? `（${p.item}）` : ""}</li>`).join("");

  document.getElementById("team2").innerHTML =
    team2.map(p => `<li>${p.name}${p.item ? `（${p.item}）` : ""}</li>`).join("");

}

const ENEMY_MOVES = [
  { id: 1, name: "1の攻撃" },
  { id: 2, name: "2の攻撃" },
  { id: 3, name: "3の攻撃" },
  { id: 4, name: "4の攻撃" },
];

// ランダムで1つ選ぶ
function pickRandomMove() {
  const i = Math.floor(Math.random() * ENEMY_MOVES.length);
  return ENEMY_MOVES[i];
}

// ログに追加
function addLog(text) {
  const li = document.createElement("li");
  li.textContent = text;
  document.getElementById("battleLog").prepend(li);
}

// 敵の1ターン
function enemyTurn() {
  const move = pickRandomMove();
  document.getElementById("enemyStatus").textContent = `敵の行動：${move.name}`;
  addLog(`敵は ${move.name} を選んだ！`);
}

function resetEnemy() {
  // 行動表示を初期状態に戻す
  document.getElementById("enemyStatus").textContent = "敵は待機中";

  // ログを消す（不要ならこの行は削除OK）
  document.getElementById("battleLog").innerHTML = "";
}

</script>

</body>
</html>