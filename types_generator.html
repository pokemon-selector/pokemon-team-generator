<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>types_db.json 生成</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 16px; }
    button { width: 100%; padding: 12px; font-size: 16px; margin: 10px 0; }
    pre { background:#f5f5f5; padding:12px; border-radius:10px; overflow:auto; }
    textarea { width: 100%; height: 260px; }
    .row { display:flex; gap:8px; }
    .row > * { flex:1; }
  </style>
</head>
<body>
  <h1>types_db.json 生成</h1>

  <div class="row">
    <button id="run">生成</button>
    <button id="copy">JSONをコピー</button>
  </div>

  <pre id="log"></pre>
  <textarea id="out" placeholder="ここにJSONが出ます（コピーして types_db.json に保存）"></textarea>

<script>
// ===== あなたのRAW_BOX（ここは既存のをそのまま貼る）=====
const RAW_BOX = [
    "フシギソウ",
    "フシギバナ",
    "リザード",
    "リザードン",
    "カメックス",
    "バタフリー",
    "スピアー",
    "ピジョン",
    "ピジョット",
    "ラッタ",
    "オニドリル",
    "アーボック",
    "ピカチュウ",
    "ライチュウ",
    "サンドパン",
    "ニドリーナ",
    "ニドクイン",
    "ニドリーノ",
    "ニドキング",
    "ピクシー",
    "キュウコン",
    "プクリン",
    "ゴルバット",
    "クサイハナ",
    "ラフレシア",
    "パラセクト",
    "モルフォン",
    "ダグトリオ",
    "ペルシアン",
    "ゴルダック",
    "マンキー",
    "ウインディ",
    "ニョロボン",
    "ユンゲラー",
    "フーディン",
    "ゴーリキー",
    "カイリキー",
    "マダツボミ",
    "ウツドン",
    "ドククラゲ",
    "ゴローン",
    "ゴローニャ",
    "ギャロップ",
    "ヤドラン",
    "レアコイル",
    "カモネギ",
    "ドードリオ",
    "ジュゴン",
    "ベトベトン",
    "パルシェン",
    "ゴースト",
    "ゲンガー",
    "スリーパー",
    "キングラー",
    "マルマイン",
    "ナッシー",
    "ガラガラ",
    "サワムラー",
    "エビワラー",
    "マタドガス",
    "サイドン",
    "ラッキー",
    "ガルーラ",
    "シードラ",
    "アズマオウ",
    "スターミー",
    "バリヤード",
    "ストライク",
    "ルージュラ",
    "エレブー",
    "ブーバー",
    "カイロス",
    "ケンタロス",
    "ギャラドス",
    "ラプラス",
    "シャワーズ",
    "サンダース",
    "ブースター",
    "オムスター",
    "カブトプス",
    "プテラ",
    "カビゴン",
    "フリーザー",
    "サンダー",
    "ファイヤー",
    "ハクリュー",
    "カイリュー",
    "ミュウツー",
    "ベイリーフ",
    "メガニウム",
    "マグマラシ",
    "バクフーン",
    "アリゲイツ",
    "ヨルノズク",
    "レディアン",
    "アリアドス",
    "クロバット",
    "ランターン",
    "トゲチック",
    "ネイティオ",
    "デンリュウ",
    "キレイハナ",
    "マリル",
    "マリルリ",
    "ウソッキー",
    "ニョロトノ",
    "ハネッコ",
    "ポポッコ",
    "キマワリ",
    "ヌオー",
    "エーフィ",
    "ブラッキー",
    "ヤドキング",
    "ソーナンス",
    "キリンリキ",
    "フォレトス",
    "ノコッチ",
    "グライガー",
    "ハガネール",
    "グランブル",
    "ハリーセン",
    "ハッサム",
    "ツボツボ",
    "ヘラクロス",
    "リングマ",
    "マグカルゴ",
    "イノムー",
    "サニーゴ",
    "オクタン",
    "デリバード",
    "マンタイン",
    "エアームド",
    "ヘルガー",
    "キングドラ",
    "ドンファン",
    "ポリゴン2",
    "オドシシ",
    "カポエラー",
    "ミルタンク",
    "ハピナス",
    "ライコウ",
    "エンテイ",
    "スイクン",
    "サナギラス",
    "バンギラス",
    "ルギア",
    "ホウオウ",
    "ジュプトル",
    "ジュカイン",
    "ワカシャモ",
    "バシャーモ",
    "ヌマクロー",
    "ラグラージ",
    "グラエナ",
    "マッスグマ",
    "カラサリス",
    "アゲハント",
    "マユルド",
    "ドクケイル",
    "ハスブレロ",
    "ルンパッパ",
    "コノハナ",
    "ダーテング",
    "オオスバメ",
    "ペリッパー",
    "キルリア",
    "サーナイト",
    "アメモース",
    "キノガッサ",
    "ケッキング",
    "テッカニン",
    "ヌケニン",
    "ドゴーム",
    "バクオング",
    "ハリテヤマ",
    "エネコロロ",
    "ヤミラミ",
    "クチート",
    "ココドラ",
    "コドラ",
    "ボスゴドラ",
    "チャーレム",
    "ライボルト",
    "プラスル",
    "バルビート",
    "イルミーゼ",
    "サメハダー",
    "ホエルオー",
    "コータス",
    "バクーダ",
    "パッチール",
    "ビブラーバ",
    "フライゴン",
    "サボネア",
    "チルタリス",
    "ザングース",
    "ハブネーク",
    "ルナトーン",
    "ソルロック",
    "ナマズン",
    "シザリガー",
    "ネンドール",
    "リリーラ",
    "ユレイドル",
    "アーマルド",
    "ミロカロス",
    "ポワルン",
    "ジュペッタ",
    "サマヨール",
    "トロピウス",
    "チリーン",
    "アブソル",
    "オニゴーリ",
    "トドゼルガ",
    "ハンテール",
    "サクラビス",
    "ジーランス",
    "コモルー",
    "ボーマンダ",
    "メタグロス",
    "レジロック",
    "レジアイス",
    "レジスチル",
    "ラティアス",
    "ラティオス",
    "カイオーガ",
    "グラードン",
    "レックウザ",
    "ハヤシガメ",
    "ドダイトス",
    "モウカザル",
    "ゴウカザル",
    "ポッタイシ",
    "エンペルト",
    "ムクバード",
    "ムクホーク",
    "ビーダル",
    "コロトック",
    "ルクシオ",
    "レントラー",
    "ロズレイド",
    "ラムパルド",
    "トリデプス",
    "ミノマダム",
    "ガーメイル",
    "ビークイン",
    "パチリス",
    "フローゼル",
    "チェリム",
    "トリトドン",
    "エテボース",
    "フワライド",
    "ミミロップ",
    "ムウマージ",
    "ドンカラス",
    "ブニャット",
    "スカタンク",
    "ドータクン",
    "ペラップ",
    "ミカルゲ",
    "ガブリアス",
    "ルカリオ",
    "カバルドン",
    "ドラピオン",
    "ドクロッグ",
    "ネオラント",
    "ユキノオー",
    "マニューラ",
    "ジバコイル",
    "ベロベルト",
    "ドサイドン",
    "モジャンボ",
    "エレキブル",
    "ブーバーン",
    "トゲキッス",
    "メガヤンマ",
    "リーフィア",
    "グレイシア",
    "グライオン",
    "マンムー",
    "ポリゴンZ",
    "エルレイド",
    "ダイノーズ",
    "ヨノワール",
    "ユキメノコ",
    "ロトム",
    "ユクシー",
    "エムリット",
    "アグノム",
    "ディアルガ",
    "パルキア",
    "ヒードラン",
    "レジギガス",
    "ギラティナ",
    "クレセリア",
    "ジャノビー",      
    "ジャローダ",    
    "チャオブー",     
    "エンブオー",     
    "フタチマル",    
    "ダイケンキ",     
    "ミルホッグ",    
    "ハーデリア",   
    "ムーランド",    
    "レパルダス",     
    "ヤナッキー",      
    "バオッキー",    
    "ムシャーナ",    
    "ハトーボー",      
    "ケンホロウ",     
    "ゼブライカ",      
    "ガントル",       
    "ギガイアス",      
    "ココロモリ",      
    "ドリュウズ",     
    "タブンネ",        
    "ドテッコツ",      
    "ローブシン",    
    "ガマガル",        
    "ガマゲロゲ",      
    "ナゲキ",          
    "ダゲキ",          
    "クルマユ",      
    "ハハコモリ",     
    "ホイーガ",       
    "ペンドラー",     
    "エルフーン",      
    "ドレディア",      
    "バスラオ",       
    "ワルビル",       
    "ワルビアル",     
    "ヒヒダルマ",      
    "マラカッチ",      
    "イワパレス",      
    "ズルズキン",     
    "シンボラー",      
    "デスカーン",     
    "アバゴーラ",     
    "アーケオス",      
    "ダストダス",     
    "ゾロアーク",      
    "ゴチミル",        
    "ゴチルゼル",      
    "スワンナ",       
    "バニリッチ",     
    "バイバニラ",      
    "シキジカ",        
    "エモンガ",       
    "シュバルゴ",      
    "モロバレル",      
    "ブルンゲル",     
    "ママンボウ", 
    "デンチュラ",
    "ナットレイ",
    "ギギギアル",
    "シビルドン",
    "ランクルス",
    "ランプラー",
    "シャンデラ",
    "オノンド",
    "オノノクス",
    "ツンベアー",
    "フリージオ",
    "アギルダー",
    "マッギョ",
    "コジョンド",
    "クリムガン",
    "ゴルーグ",
    "コマタナ",
    "バッフロン",
    "ウォーグル",
    "バルジーナ",
    "クイタラン",
    "アイアント",
    "ジヘッド",
    "サザンドラ",
    "ウルガモス",
    "コバルオン",
    "テラキオン",
    "ビリジオン",
    "トルネロス",
    "ボルトロス",
    "レシラム",
    "ゼクロム",
    "ランドロス",
    "ハリボーグ",
    "ブリガロン",
    "テールナー",
    "マフォクシー",
    "ゲコガシラ",
    "ゲッコウガ",
    "ホルード",
    "ヒノヤコマ",
    "ファイアロー",
    "ビビヨン",
    "カエンジシ",
    "フラエッテ",
    "フラージェス",
    "ゴーゴート",
    "ゴロンダ",
    "トリミアン",
    "ニャオニクス",
    "ヒトツキ",
    "ギルガルド",
    "アロマティス",
    "ペロリーム",
    "カラマネロ",
    "ガメノデス",
    "ドラミドロ",
    "ブロスター",
    "エレザード",
    "ガチゴラス",
    "アマルルガ",
    "ニンフィア",
    "ルチャブル",
    "デデンネ",
    "メレシー",
    "ヌメイル",
    "ヌメルゴン",
    "クレッフィ",
    "ボクレー",
    "オーロット",
    "クレベース",
    "ファイアロー",
    "ゼルネアス",
    "イベルタル",
    "フクスロー",
    "ジュナイパー",
    "ニャヒート",
    "ガオガエン",
    "オシャマリ",
    "アシレーヌ",
    "ケケンカニ",
    "デカグース",
    "クワガノン",
    "キケンカニ",
    "アブリボン",
    "ルガルガン",
    "ドヒドイデ",
    "バンバドロ",
    "オニシズクモ",
    "ラランテス",
    "マシェード",
    "エンニュート",
    "キテルグマ",
    "アマージョ",
    "キュワワー",
    "ヤレユータン",
    "ナゲツケサル",
    "グソクムシャ",
    "シロデスナ",
    "ナマコブシ",
    "シルヴァディ",
    "メテノ",
    "ネッコアラ",
    "バクガメス",
    "トゲデマル",
    "ミミッキュ",
    "ハギギシリ",
    "ジジーロン",
    "ダダリン",
    "ジャランゴ",
    "ジャラランガ",
    "カプ・コケコ",
    "カプ・テテフ",
    "カプ・ブルル",
    "カプ・レヒレ",
    "ウツロイド",
    "マッシブーン",
    "フェローチェ",
    "デンジュモク",
    "テッカグヤ",
    "カミツルギ",
    "アクジキング",
    "ネクロズマ",
    "アローラライチュウ",
    "アローラガラガラ",
    "アローラサンドパン",
    "アローラキュウコン",
    "アローラダグトリオ",
    "アローラナッシー",
    "アローラゴローニャ",
    "アローラベトベトン"
];

// 日本語名 -> PokéAPI pokemon identifier（リージョンなど例外）
const FORM_ALIAS = {
  "アローラライチュウ": "raichu-alola",
  "アローラガラガラ": "marowak-alola",
  "アローラサンドパン": "sandslash-alola",
  "アローラキュウコン": "ninetales-alola",
  "アローラダグトリオ": "dugtrio-alola",
  "アローラナッシー": "exeggutor-alola",
  "アローラゴローニャ": "golem-alola",
  "アローラベトベトン": "muk-alola"
};

const TYPE_EN_TO_JA = {
  normal: "ノーマル",
  fire: "ほのお",
  water: "みず",
  electric: "でんき",
  grass: "くさ",
  ice: "こおり",
  fighting: "かくとう",
  poison: "どく",
  ground: "じめん",
  flying: "ひこう",
  psychic: "エスパー",
  bug: "むし",
  rock: "いわ",
  ghost: "ゴースト",
  dragon: "ドラゴン",
  dark: "あく",
  steel: "はがね",
  fairy: "フェアリー"
};

const logEl = document.getElementById("log");
const outEl = document.getElementById("out");
const copyBtn = document.getElementById("copy");

function log(s) { logEl.textContent += s + "\n"; }

async function fetchJson(url) {
  const res = await fetch(url);
  if (!res.ok) throw new Error(`${url} の取得に失敗: ${res.status}`);
  return res.json();
}

// ここが軽量版の肝：
// "pokemon-species?limit=807" を1回取って、各speciesの詳細は必要な分だけ引く
async function buildJpNameToIdentifier() {
  log("species一覧を取得中...");
  const list = await fetchJson("https://pokeapi.co/api/v2/pokemon-species?limit=10000");
  const map = new Map(); // 日本語名 -> default pokemon identifier

  // USUM(全国図鑑807)までを想定。list.resultsは全部あるので、必要分だけ使う
  // ただし日本語名はspecies詳細にあるので、必要な名前だけ詳細を取りに行く
  return { list, map };
}

// species詳細から 日本語名 と default pokemon identifier を取る
async function resolveFromSpeciesUrl(speciesUrl) {
  const sp = await fetchJson(speciesUrl);

  // 日本語名（ja-Hrkt）
  const ja = sp.names.find(n => n.language.name === "ja-Hrkt")?.name;

  // default pokemon identifier
  const defVar = sp.varieties.find(v => v.is_default);
  const identifier = defVar?.pokemon?.name;

  return { ja, identifier };
}

async function getTypesByPokemonIdentifier(identifier) {
  const data = await fetchJson(`https://pokeapi.co/api/v2/pokemon/${identifier}/`);
  const typesEn = data.types.map(t => t.type.name);
  return typesEn.map(en => TYPE_EN_TO_JA[en]).filter(Boolean);
}

document.getElementBy_attachEvent = null;

document.getElementById("run").addEventListener("click", async () => {
  logEl.textContent = "";
  outEl.value = "";

  try {
    // 1) 例外フォームは先に処理
    const db = {};
    let done = 0;

    // 2) 通常名の集合（例外を除く）
    const normalNames = RAW_BOX.filter(n => !FORM_ALIAS[n]);
    const normalSet = new Set(normalNames);

    // 3) species一覧取得
    const { list } = await buildJpNameToIdentifier();

    // 4) speciesを走査して、RAW_BOXにある日本語名だけ解決する
    log(`species詳細を解決中（対象: ${normalSet.size}件）...`);

    for (const item of list.results) {
      if (normalSet.size === 0) break;

      const { ja, identifier } = await resolveFromSpeciesUrl(item.url);
      if (!ja || !identifier) continue;

      if (normalSet.has(ja)) {
        db[ja] = await getTypesByPokemonIdentifier(identifier);
        normalSet.delete(ja);
        done++;
        log(`OK ${done}/${RAW_BOX.length}: ${ja}`);
      }
    }

    // 5) 例外フォーム
    for (const name of RAW_BOX) {
      const alias = FORM_ALIAS[name];
      if (!alias) continue;
      db[name] = await getTypesByPokemonIdentifier(alias);
      done++;
      log(`OK ${done}/${RAW_BOX.length}: ${name}`);
    }

    // 6) 未解決があればログ
    if (normalSet.size > 0) {
      log("未解決（表記ゆれの可能性）:");
      for (const n of normalSet) log(" - " + n);
    }

    outEl.value = JSON.stringify(db, null, 2);
    log("完了！出力JSONをコピーして types_db.json に保存してください。");

  } catch (e) {
    console.error(e);
    log("ERROR: " + e.message);
  }
});

copyBtn.addEventListener("click", async () => {
  try {
    await navigator.clipboard.writeText(outEl.value);
    log("クリップボードにコピーしました。");
  } catch {
    log("コピーに失敗しました。手動でコピーしてください。");
  }
});
</script>
</body>
</html>